<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Xio Assets Shop</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-section">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
                <p>Welcome back to Xio Assets Shop</p>
            </div>
            <div class="header-actions">
                <a href="/" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Shop</a>
                <a href="/logout" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
    </header>

    <section class="dashboard-section">
        <div class="dashboard-container">
            <div class="user-profile">
                <div class="profile-header">
                    <div class="avatar-container">
                        <img id="user-avatar" src="" alt="Avatar" class="user-avatar">
                    </div>
                    <div class="user-info">
                        <h2 id="user-name">Loading...</h2>
                        <p id="user-email">Loading...</p>
                        <div class="user-stats">
                            <div class="stat">
                                <span class="stat-number" id="purchases-count">0</span>
                                <span class="stat-label">Purchases</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" id="favorites-count">0</span>
                                <span class="stat-label">Favorites</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="card-content">
                        <h3>My Cart</h3>
                        <p>View and manage your shopping cart</p>
                        <button class="card-btn" onclick="showCart()">
                            <i class="fas fa-eye"></i> View Cart
                        </button>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="card-content">
                        <h3>Wishlist</h3>
                        <p>Your saved favorite products</p>
                        <button class="card-btn" onclick="showWishlist()">
                            <i class="fas fa-eye"></i> View Wishlist
                        </button>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="card-content">
                        <h3>Purchase History</h3>
                        <p>View your past purchases</p>
                        <button class="card-btn">
                            <i class="fas fa-clock"></i> View History
                        </button>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="card-content">
                        <h3>Settings</h3>
                        <p>Manage your account settings</p>
                        <button class="card-btn">
                            <i class="fas fa-wrench"></i> Open Settings
                        </button>
                    </div>
                </div>
            </div>

            <div class="recent-activity">
                <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                <div class="activity-list" id="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="activity-content">
                            <p>Welcome to Xio Assets Shop!</p>
                            <span class="activity-time">Just now</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCartModal()">&times;</span>
            <h2><i class="fas fa-shopping-cart"></i> Your Cart</h2>
            <div id="cart-items" class="cart-items"></div>
            <div class="cart-total">
                <strong>Total: <span id="cart-total">$0.00</span></strong>
            </div>
            <button class="checkout-btn" onclick="checkout()">
                <i class="fas fa-credit-card"></i> Checkout
            </button>
        </div>
    </div>

    <!-- Wishlist Modal -->
    <div id="wishlist-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWishlistModal()">&times;</span>
            <h2><i class="fas fa-heart"></i> Your Wishlist</h2>
            <div id="wishlist-items" class="wishlist-items"></div>
        </div>
    </div>

    <script>
        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch('/api/user');
                const user = await response.json();

                document.getElementById('user-name').textContent = `${user.username}#${user.discriminator}`;
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('user-avatar').src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;

                // Load cart and wishlist counts
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];

                document.getElementById('purchases-count').textContent = '0'; // This would come from backend
                document.getElementById('favorites-count').textContent = wishlist.length;

            } catch (error) {
                console.error('Error loading user data:', error);
                window.location.href = '/';
            }
        }

        // Cart and wishlist functions (similar to main script)
        function showCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';

            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            if (cart.length === 0) {
                cartItems.innerHTML = '<p>Your cart is empty</p>';
                return;
            }

            let total = 0;
            cart.forEach(index => {
                const product = products[index];
                total += product.priceUSD;

                const item = document.createElement('div');
                item.className = 'cart-item';
                item.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="cart-item-image">
                    <div class="cart-item-details">
                        <h4>${product.name}</h4>
                        <p>$${product.priceUSD}</p>
                    </div>
                    <button class="remove-btn" onclick="removeFromCart(${index}); showCart();">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                `;
                cartItems.appendChild(item);
            });

            document.getElementById('cart-total').textContent = `$${total.toFixed(2)}`;
            document.getElementById('cart-modal').style.display = 'block';
        }

        function showWishlist() {
            const wishlistItems = document.getElementById('wishlist-items');
            wishlistItems.innerHTML = '';

            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];

            if (wishlist.length === 0) {
                wishlistItems.innerHTML = '<p>Your wishlist is empty</p>';
                return;
            }

            wishlist.forEach(index => {
                const product = products[index];
                const item = document.createElement('div');
                item.className = 'wishlist-item';
                item.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="wishlist-item-image">
                    <div class="wishlist-item-details">
                        <h4>${product.name}</h4>
                        <p>$${product.priceUSD}</p>
                    </div>
                    <div class="wishlist-actions">
                        <button class="add-to-cart-btn" onclick="toggleCart(${index}); showWishlist();">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                        <button class="remove-btn" onclick="toggleWishlist(${index}); showWishlist();">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                `;
                wishlistItems.appendChild(item);
            });

            document.getElementById('wishlist-modal').style.display = 'block';
        }

        function removeFromCart(index) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartIndex = cart.indexOf(index);
            if (cartIndex > -1) {
                cart.splice(cartIndex, 1);
                localStorage.setItem('cart', JSON.stringify(cart));
            }
        }

        function toggleCart(index) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const indexInCart = cart.indexOf(index);
            if (indexInCart > -1) {
                cart.splice(indexInCart, 1);
            } else {
                cart.push(index);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function toggleWishlist(index) {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const indexInWishlist = wishlist.indexOf(index);
            if (indexInWishlist > -1) {
                wishlist.splice(indexInWishlist, 1);
            } else {
                wishlist.push(index);
            }
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
        }

        function closeCartModal() {
            document.getElementById('cart-modal').style.display = 'none';
        }

        function closeWishlistModal() {
            document.getElementById('wishlist-modal').style.display = 'none';
        }

        function checkout() {
            // Redirect to main shop for checkout
            window.location.href = '/';
        }

        // Sample products data (should match main script)
        const products = [
            { name: "Tip Jar V5", priceUSD: 40, image: "https://via.placeholder.com/320x180/333/fff?text=Tip+Jar+V5" },
            { name: "Inventory System", priceUSD: 6.72, image: "https://via.placeholder.com/320x180/333/fff?text=Inventory+System" },
            // Add more products as needed
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
        });
    </script>
</body>
</html>
